<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="OrderDAO">
	
	<resultMap type="OrderMenu" id="OrderMenuResult">
 		<id property="order_menu_code" column="ORDER_MENU_CODE"/>
 		<result property="order_menu_price" column="ORDER_MENU_PRICE"/>
 		<result property="order_menu_count" column="ORDER_MENU_COUNT"/>
 		
 	<collection property="order" ofType="Order">
 		<id property="order_code" column="ORDER_CODE"/>
 		<result property="orderState" column="ORDERSTATE"/>
 		<result property="orderDate" column="ORDERDATE"/>
 			<collection property="member" ofType="Member">
 				<id property="member_code" column="MEMBER_CODE"/>
		 		<result property="member_id" column="MEMBER_ID"/>
		 		<result property="member_pw" column="MEMBER_PW"/>
		 		<result property="member_name" column="MEMBER_NAME"/>
		 		<result property="member_contact" column="MEMBER_CONTACT"/>
		 		<result property="member_email" column="MEMBER_EMAIL"/>
		 		<result property="member_road_address" column="MEMBER_ROAD_ADDRESS"/>
		 		<result property="member_jibun_address" column="MEMBER_JIBUN_ADDRESS"/>
		 		<result property="member_detail_address" column="MEMBER_DETAIL_ADDRESS"/>
		 		<result property="enabled" column="ENABLED"/>
	 		</collection>
 	</collection>
 	
 	<collection property="menu" ofType="Menu">
 		<id property="menu_code" column="MENU_CODE"/>
 		<result property="menu_price" column="MENU_PRICE"/>
 		<result property="menu_type" column="MENU_TYPE"/>
 		<result property="menu_name" column="MENU_NAME"/>
 		<result property="menu_explain" column="MENU_EXPLAIN"/>
 		<result property="menu_img_path" column="MENU_IMG_PATH" />
 		<result property="menu_quantity" column="MENU_QUANTITY" />	
 	</collection>
 		
 	</resultMap>
 	
 	<resultMap type="Order" id="OrderResult">
 		<id property="order_code" column="ORDER_CODE"/>
 		<result property="orderState" column="ORDERSTATE"/>
 		<result property="orderDate" column="ORDERDATE"/>
 		<collection property="member" ofType="Member">
 			<id property="member_code" column="MEMBER_CODE"/>
	 		<result property="member_id" column="MEMBER_ID"/>
	 		<result property="member_pw" column="MEMBER_PW"/>
	 		<result property="member_name" column="MEMBER_NAME"/>
	 		<result property="member_contact" column="MEMBER_CONTACT"/>
	 		<result property="member_email" column="MEMBER_EMAIL"/>
	 		<result property="member_road_address" column="MEMBER_ROAD_ADDRESS"/>
	 		<result property="member_jibun_address" column="MEMBER_JIBUN_ADDRESS"/>
	 		<result property="member_detail_address" column="MEMBER_DETAIL_ADDRESS"/>
	 		<result property="enabled" column="ENABLED"/>
	 	</collection>
	 	
	 	<collection property="orderMenuList" ofType="OrderMenu" javaType="List">
	 		<id property="order_menu_code" column="ORDER_MENU_CODE"/>
 			<result property="total_order_price" column="TOTAL_ORDER_PRICE"/>
 			<result property="total_order_count" column="TOTAL_ORDER_COUNT"/>
 		
			 	<collection property="order" ofType="Order">
			 		<id property="order_code" column="ORDER_CODE"/>
			 		<result property="orderState" column="ORDERSTATE"/>
			 		<result property="orderDate" column="ORDERDATE"/>
			 			<collection property="member" ofType="Member">
			 				<id property="member_code" column="MEMBER_CODE"/>
					 		<result property="member_id" column="MEMBER_ID"/>
					 		<result property="member_pw" column="MEMBER_PW"/>
					 		<result property="member_name" column="MEMBER_NAME"/>
					 		<result property="member_contact" column="MEMBER_CONTACT"/>
					 		<result property="member_email" column="MEMBER_EMAIL"/>
					 		<result property="member_road_address" column="MEMBER_ROAD_ADDRESS"/>
					 		<result property="member_jibun_address" column="MEMBER_JIBUN_ADDRESS"/>
					 		<result property="member_detail_address" column="MEMBER_DETAIL_ADDRESS"/>
					 		<result property="enabled" column="ENABLED"/>
				 		</collection>
			 	</collection>
			 	
			 	<collection property="menu" ofType="Menu">
			 		<id property="menu_code" column="MENU_CODE"/>
			 		<result property="menu_price" column="MENU_PRICE"/>
			 		<result property="menu_type" column="MENU_TYPE"/>
			 		<result property="menu_name" column="MENU_NAME"/>
			 		<result property="menu_explain" column="MENU_EXPLAIN"/>
			 		<result property="menu_img_path" column="MENU_IMG_PATH" />
			 		<result property="menu_quantity" column="MENU_QUANTITY" />	
			 	</collection>
	 	</collection>
 	</resultMap>
	
	
	<insert id="insertOrder" parameterType="Map">
		INSERT INTO cafehi_order(order_code, member_code, orderState, orderDate)
		VALUES((select nvl(max(order_code), 0)+1 from cafehi_order), #{member_code}, #{order.orderState}, #{order.orderDate})
	</insert>
	
	<select id="getOrder" parameterType="Member" resultMap="OrderResult">
		SELECT * FROM cafehi_order
		WHERE member_code = #{member_code}
	</select>
	
	
	<insert id="insertOrderMenu" parameterType="Map">
		INSERT INTO cafehi_order_menu(order_menu_code, order_code, menu_code, total_order_price, total_order_count)
		VALUES((select nvl(max(order_menu_code), 0)+1 from cafehi_order_menu), (select nvl(max(order_menu_code), 0)+1 from cafehi_order_menu) , #{menu_code}, #{orderMenu.total_order_price}, #{orderMenu.total_order_count} )
	</insert>
	
	
	

	
	
	
<!-- 	<select id="sumOrderMoney" resultType="int">
 		SELECT nvl(sum(menu_price*order_count), 0)
 		금액과 상품갯수를 곱한값과 0을더해서 0이 나오는 것을 검색한다.
 		그러니까 아무것도 담지 않았을 때 대체 값이 0이 나오도록 함
 		
 		FROM cafehi_order o, cafehi_menu m
 		
 		WHERE o.menu_code = m.menu_code AND member_code=#{member_code}
 		
 	</select> -->
	
</mapper>