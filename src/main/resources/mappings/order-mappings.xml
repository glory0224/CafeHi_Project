<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="OrderDAO">
	
 	<!-- <resultMap type="Order" id="OrderResult">
 		<id property="order_code" column="ORDER_CODE"/>
 		<result property="member_code" column="MEMBER_CODE"/>
 		<result property="order_status" column="ORDER_STATUS"/>
 		<result property="order_writetime" column="ORDER_WRITETIME"/>
 		<result property="order_updatetime" column="ORDER_UPDATETIME"/> 		
 		<result property="include_delivery" column="INCLUDE_DELIVERY"/>
 		<association property="orderMenu" column="ORDER_MENU_CODE" javaType="orderMenu" resultMap="orderMenuResult">
 			 
 		</association>
 	</resultMap>
 	
 	<resultMap type="orderMenu" id="orderMenuResult">
 			<id  property="order_menu_code" column="ORDER_MENU_CODE"/>
		
			<result property="order_code" column="ORDER_CODE" />
		
			<result property="menu_code" column="MENU_CODE" />
		
			<result property="total_order_price" column="TOTAL_ORDER_PRICE" />
		
			<result property="total_order_count" column="TOTAL_ORDER_COUNT" />
			
			<result property="order_menu_writetime" column="ORDER_MENU_WRITETIME" />
			
			<result property="order_menu_updatetime" column="ORDER_MENU_UPDATETIME" />
 	</resultMap>
 	 -->
 	 
 	 <resultMap type="orderMenu" id="orderMenuResult">
 	 		<id  property="order_menu_code" column="ORDER_MENU_CODE"/>
		
			<result property="menu_code" column="MENU_CODE" />
		
			<result property="total_order_price" column="TOTAL_ORDER_PRICE" />
		
			<result property="total_order_count" column="TOTAL_ORDER_COUNT" />
			
			<result property="order_menu_writetime" column="ORDER_MENU_WRITETIME" />
			
			<result property="order_menu_updatetime" column="ORDER_MENU_UPDATETIME" />
 	 
 	 		<association property="order" javaType="Order">
 	 			<id property="order_code" column="ORDER_CODE"/>
		 		<result property="member_code" column="MEMBER_CODE"/>
		 		<result property="order_status" column="ORDER_STATUS"/>
		 		<result property="order_writetime" column="ORDER_WRITETIME"/>
		 		<result property="order_updatetime" column="ORDER_UPDATETIME"/> 		
		 		<result property="include_delivery" column="INCLUDE_DELIVERY"/>
 	 		</association>
				
			
 	 </resultMap>
 	 
 	 <resultMap type="Order" id="OrderResult">
 	 	
 	 	<id property="order_code" column="ORDER_CODE"/>
 		<result property="member_code" column="MEMBER_CODE"/>
 		<result property="order_status" column="ORDER_STATUS"/>
 		<result property="order_writetime" column="ORDER_WRITETIME"/>
 		<result property="order_updatetime" column="ORDER_UPDATETIME"/> 		
 		<result property="include_delivery" column="INCLUDE_DELIVERY"/>
 	 
 	 </resultMap>
	
	<insert id="insertOrder" parameterType="Order" useGeneratedKeys="true" keyProperty="order_code" keyColumn="order_code">
	INSERT INTO cafehi_order(order_code, member_code, include_delivery, order_status, order_writetime, order_updatetime)
	VALUES((select nvl(max(order_code), 0)+1 from cafehi_order), #{member_code}, #{include_delivery}, #{order_status}, #{order_writetime}, #{order_updatetime})	

</insert>
	
	
	<insert id="insertOrderMenu" parameterType="orderMenu">
	INSERT INTO cafehi_order_menu(order_menu_code, order_code, menu_code, total_order_price, total_order_count, order_menu_writetime, order_menu_updatetime)
	
	VALUES((select nvl(max(order_menu_code), 0)+1 from cafehi_order_menu), #{order.order_code} , #{menu_code}, #{total_order_price}, #{total_order_count}, #{order_menu_writetime}, #{order_menu_updatetime}) 	

</insert>



<select id="getOrderMenu" parameterType="int" resultType="orderMenu">
	SELECT * FROM cafehi_order_menu
	WHERE order_menu_code = #{order_menu_code}
</select>

<select id="getOrder" parameterType="int" resultType="Order">
	SELECT * FROM cafehi_order
	WHERE order_code = #{order_code}
</select>


	
 	<update id="cancelOrder" parameterType="hashMap">
		UPDATE cafehi_order
		SET order_status = #{order_status}, order_updatetime = #{order_updatetime}
		WHERE order_code = #{order_code}
	</update>
	
	
	<select id="listOrder" parameterType="int" resultType="orderMenu">
	  	SELECT *
		FROM cafehi_order o JOIN cafehi_order_menu om
		ON o.order_code = om.order_code AND o.member_code = #{member_code}
	</select>	
	
	
</mapper>