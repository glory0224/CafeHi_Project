<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="OrderDAO">
	
 	<resultMap type="Order" id="OrderResult">
 		<id property="order_code" column="ORDER_CODE"/>
 		<result property="member_code" column="MEMBER_CODE"/>
 		<result property="orderState" column="ORDERSTATE"/>
 		<result property="orderDate" column="ORDERDATE"/>
 		<result property="orderUpdateDate" column="ORDERUPDATEDATE"/> 		
 		<result property="include_delivery" column="INCLUDE_DELIVERY"/>
 		
	 	
	 	<collection property="orderMenu"  ofType="OrderMenu" > <!-- ofType="OrderMenu" javaType="List"  -->
	 		<id property="order_menu_code" column="ORDER_MENU_CODE"/>
	 		<result property="order_code" column="ORDER_CODE"/>
 			<result property="menu_code" column="MENU_CODE"/>
 			<result property="total_order_price" column="TOTAL_ORDER_PRICE"/>
 			<result property="total_order_count" column="TOTAL_ORDER_COUNT"/>
 			
	 	</collection>
	 	
 	</resultMap>
	
	
	<insert id="insertOrder" parameterType="Map">
		INSERT INTO cafehi_order(order_code, member_code, include_delivery, orderState, orderDate, orderUpdateDate)
		VALUES((select nvl(max(order_code), 0)+1 from cafehi_order), #{member_code}, #{order.include_delivery}, #{order.orderState}, #{order.orderDate}, #{order.orderDate})
	</insert>
	
	
	<insert id="insertOrderMenu" parameterType="Map">
		INSERT INTO cafehi_order_menu(order_menu_code, order_code, menu_code, total_order_price, total_order_count)
		VALUES((select nvl(max(order_menu_code), 0)+1 from cafehi_order_menu), (select nvl(max(order_menu_code), 0)+1 from cafehi_order_menu) , #{menu_code}, #{orderMenu.total_order_price}, #{orderMenu.total_order_count} )
	</insert>
	
 	<update id="cancelOrder" parameterType="hashMap">
		UPDATE cafehi_order
		SET orderState = #{orderState}, orderUpdateDate = #{orderUpateDate}
		WHERE order_code = #{order_code}
	</update>
	
	
	<select id="listOrder" parameterType="int" resultMap="OrderResult">
	  	SELECT om.order_menu_code, om.order_code, om.menu_code, om.total_order_price, om.total_order_count, o.member_code, o.orderState, o.orderDate, o.orderUpdateDate, o.include_delivery
		FROM cafehi_order o LEFT OUTER JOIN cafehi_order_menu om
		ON o.order_code = om.order_code AND o.member_code = #{member_code}
	</select>	
	

	
</mapper>